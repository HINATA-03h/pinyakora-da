<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒžãƒ¼</title>
  <style>
    body {
      background-image: url("backgroundpicture.jpg");
      background-size: 120% 120%;
      background-position: center;
      background-repeat: no-repeat;
      animation: backgroundMove 40s ease-in-out infinite alternate;
      font-family: 'Comic Sans MS', 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      overflow: hidden;
      user-select: none;
      text-shadow: 1px 1px 3px #fff8c4;
    }

    h1 {
      color: #ff7f00;
      font-size: 42px;
      margin-bottom: 30px;
      text-shadow: 2px 2px 5px #ffbb33;
      animation: fadeIn 2s ease-in-out;
    }

    .inputs, .buttons {
      display: flex;
      gap: 20px;
      margin: 10px;
      animation: fadeInZoom 1s ease-in-out;
    }

    .input-group {
      display: flex;
      align-items: center;
      font-size: 20px;
      color: #cc6600;
    }

    input {
      width: 70px;
      font-size: 20px;
      padding: 6px;
      text-align: center;
      border: 2px solid #ffbb33;
      border-radius: 12px;
      background-color: #fff4cc;
      color: #cc6600;
      font-weight: bold;
      margin-right: 5px;
    }

    button {
      font-size: 20px;
      padding: 12px 30px;
      background-color: #ffbb33;
      color: #663300;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 5px 0 #cc6600;
      transition: transform 0.3s ease;
    }

    button:hover {
      transform: scale(1.1);
    }

    #timer {
      font-size: 90px;
      font-weight: 900;
      margin-top: 40px;
      background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8f00ff);
      background-size: 400% 400%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rainbow 6s linear infinite;
      text-align: center;
    }

    #timer.bump {
      animation: bump 0.4s ease;
    }

    .star, .heart, .bubble, .particle {
      position: absolute;
      pointer-events: none;
      z-index: 9999;
      font-size: 24px;
    }

    .star {
      color: gold;
      animation: fall 6s linear forwards;
    }

    .heart {
      color: pink;
      animation: fall 6s linear forwards;
    }

    .bubble {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      animation: bubbleUp 3s ease-out forwards;
    }

    .particle {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: particleBurst 1.2s ease-out forwards;
    }

    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
    @keyframes rainbow {
      0% { background-position: 0% 50%; }
      100% { background-position: 400% 50%; }
    }

    @keyframes fadeInZoom {
      0% { opacity: 0; transform: scale(0.8); }
      100% { opacity: 1; transform: scale(1); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fall {
      0% { transform: translateY(-100px); opacity: 1; }
      100% { transform: translateY(110vh); opacity: 0; }
    }

    @keyframes bubbleUp {
      0% { transform: translateY(0) scale(1); opacity: 0.9; }
      100% { transform: translateY(-150px) scale(1.3); opacity: 0; }
    }

    @keyframes bump {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    @keyframes backgroundMove {
      0% {
        background-size: 120% 120%;
        background-position: center;
      }
      100% {
        background-size: 125% 125%;
        background-position: top left;
      }
    }

    @keyframes particleBurst {
      0% { transform: translate(0, 0) scale(1); opacity: 1; }
      100% { transform: translate(var(--x), var(--y)) scale(0.5); opacity: 0; }
    }
  </style>
</head>
<body>
  <h1>ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒžãƒ¼</h1>

  <div class="inputs">
    <div class="input-group">
      <input type="number" id="minutes" min="0" value="0" />
      <span>åˆ†</span>
    </div>
    <div class="input-group">
      <input type="number" id="seconds" min="0" value="10" />
      <span>ç§’</span>
    </div>
  </div>

  <div class="buttons">
    <button onclick="startTimer()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button onclick="stopTimer()">ã‚¹ãƒˆãƒƒãƒ—</button>
    <button onclick="resetTimer()">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <div id="timer">00:10</div>

  <audio id="alarmSound">
    <source src="army-bugle.mp3" type="audio/mpeg" />
  </audio>

  <audio id="bgm" loop preload="auto">
    <source src="https://bgmer.net/wp-content/uploads/2025/04/449_BPM120.mp3" type="audio/mpeg" />
  </audio>

  <script>
    let countdownInterval;
    let remainingSeconds = 0;
    let isRunning = false;

    function updateDisplay(seconds) {
      const min = String(Math.floor(seconds / 60)).padStart(2, '0');
      const sec = String(seconds % 60).padStart(2, '0');
      const timer = document.getElementById('timer');
      timer.textContent = `${min}:${sec}`;
      timer.classList.remove('bump');
      void timer.offsetWidth;
      timer.classList.add('bump');
    }

    function updateFromInput() {
      if (isRunning) return;
      const min = parseInt(document.getElementById('minutes').value) || 0;
      const sec = parseInt(document.getElementById('seconds').value) || 0;
      remainingSeconds = min * 60 + sec;
      updateDisplay(remainingSeconds);
    }

    function startTimer() {
      if (isRunning) return;
      if (remainingSeconds === 0) updateFromInput();
      if (remainingSeconds <= 0) return;

      isRunning = true;
      const bgm = document.getElementById('bgm');
      const alarmSound = document.getElementById('alarmSound'); 

      // --- â˜… ä¿®æ­£ç®‡æ‰€: ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ã®å†ç”Ÿæ¨©é™ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®å‡¦ç† ---
      // 1. ãƒŸãƒ¥ãƒ¼ãƒˆã—ã¦å†ç”Ÿã‚’è©¦ã¿ã‚‹
      alarmSound.muted = true;
      alarmSound.currentTime = 0;
      alarmSound.play().then(() => {
          // 2. æˆåŠŸã—ãŸã‚‰ä¸€æ™‚åœæ­¢ã—ã€ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ï¼ˆéŸ³ã‚’å‡ºã•ãšã«å†ç”Ÿæ¨©é™ã‚’å¾—ã‚‹ï¼‰
          alarmSound.pause();
          alarmSound.currentTime = 0;
          alarmSound.muted = false;
      }).catch((error) => {
          // ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼ˆã“ã®ã¾ã¾ã§ã‚‚OKï¼‰
          alarmSound.muted = false;
          console.log("Alarm sound pre-play was blocked:", error);
      });
      // -----------------------------------------------------

      bgm.currentTime = 0;
      bgm.play().catch(() => {
          console.log("BGM auto-play blocked.");
      });

      countdownInterval = setInterval(() => {
        if (remainingSeconds <= 0) {
          clearInterval(countdownInterval);
          isRunning = false;
          
          // ã‚¿ã‚¤ãƒžãƒ¼çµ‚äº†æ™‚: å†ç”Ÿæ¨©é™ãŒã‚ã‚Œã°éŸ³ãŒé³´ã‚‹ã¯ãš
          document.getElementById('alarmSound').play().catch((error) => {
              console.log("Alarm sound play at end blocked:", error);
          });
          
          bgm.pause();
          bgm.currentTime = 0;
          celebration();
        } else {
          remainingSeconds--;
          updateDisplay(remainingSeconds);
        }
      }, 1000);
    }

    function stopTimer() {
      clearInterval(countdownInterval);
      isRunning = false;
      const bgm = document.getElementById('bgm');
      bgm.pause();
      bgm.currentTime = 0;
    }

    function resetTimer() {
      clearInterval(countdownInterval);
      isRunning = false;
      document.getElementById('minutes').value = 0;
      document.getElementById('seconds').value = 10;
      updateFromInput();
      const bgm = document.getElementById('bgm');
      bgm.pause();
      bgm.currentTime = 0;
    }

    function celebration() {
      for (let i = 0; i < 30; i++) {
        createFallingEmoji(i % 2 === 0 ? "â˜…" : "ðŸ’–", i % 2 === 0 ? "star" : "heart");
        createBubble();
        createParticle();
      }
    }

    function createFallingEmoji(char, className) {
      const el = document.createElement("div");
      el.className = className;
      el.textContent = char;
      el.style.left = Math.random() * 100 + "vw";
      el.style.top = "-50px";
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 6000);
    }

    function createBubble() {
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.style.left = Math.random() * 100 + "vw";
      bubble.style.top = Math.random() * 100 + 50 + "vh";
      bubble.style.background = `rgba(${200 + Math.random()*55},${200 + Math.random()*55},255,0.5)`;
      document.body.appendChild(bubble);
      setTimeout(() => bubble.remove(), 3000);
    }

    function createParticle() {
      const p = document.createElement('div');
      p.className = 'particle';
      p.style.background = `hsl(${Math.random() * 360}, 100%, 70%)`;
      p.style.left = `${window.innerWidth / 2}px`;
      p.style.top = `${window.innerHeight / 2}px`;
      const angle = Math.random() * 2 * Math.PI;
      const distance = 100 + Math.random() * 50;
      p.style.setProperty('--x', `${Math.cos(angle) * distance}px`);
      p.style.setProperty('--y', `${Math.sin(angle) * distance}px`);
      document.body.appendChild(p);
      setTimeout(() => p.remove(), 1200);
    }

    window.onload = updateFromInput;
    document.getElementById('minutes').addEventListener('input', updateFromInput);
    document.getElementById('seconds').addEventListener('input', updateFromInput);
  </script>
</body>
</html>